<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Distribution - Ramadan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #reader {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-yellow-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- Header with Home Button -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <button onclick="goToHome()" class="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-300">
                    <i class="fas fa-home"></i>
                    <span class="hidden sm:inline">Dashboard</span>
                </button>
                <h1 class="text-2xl md:text-3xl font-bold text-orange-700 text-center flex-1">
                    <i class="fas fa-hand-holding-dollar mr-2"></i>Cash Distribution
                </h1>
                <div class="w-20 sm:w-24"></div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mt-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-semibold text-gray-700">
                        <i class="fas fa-chart-line mr-1 text-orange-600"></i>Distribution Progress
                    </span>
                    <span class="text-sm font-bold text-orange-600">
                        <span id="progressCount">0</span> / <span id="totalFamiliesDisplay">0</span> Families
                        <span class="text-gray-500">(<span id="progressPercent">0</span>%)</span>
                    </span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden shadow-inner">
                    <div id="progressBar" class="bg-gradient-to-r from-orange-500 to-orange-600 h-4 rounded-full transition-all duration-500 ease-out flex items-center justify-end pr-2" style="width: 0%">
                        <span class="text-xs text-white font-bold drop-shadow" id="progressBarText"></span>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-1 text-center">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span id="remainingText">Setup distribution to begin</span>
                </p>
            </div>
        </div>

        <!-- Financial Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- Total Budget -->
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-wallet text-3xl opacity-80"></i>
                    <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-full">Total Budget</span>
                </div>
                <p class="text-sm opacity-90 mb-1">Total Amount</p>
                <h3 class="text-3xl font-bold">LKR <span id="totalBudget">0.00</span></h3>
            </div>

            <!-- Per Family Amount -->
            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-users text-3xl opacity-80"></i>
                    <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-full">Per Family</span>
                </div>
                <p class="text-sm opacity-90 mb-1">Each Family Gets</p>
                <h3 class="text-3xl font-bold">LKR <span id="perFamily">0.00</span></h3>
            </div>

            <!-- Balance -->
            <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <i class="fas fa-money-bill-trend-up text-3xl opacity-80 pulse-animation"></i>
                    <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-full">Live Balance</span>
                </div>
                <p class="text-sm opacity-90 mb-1">Remaining Balance</p>
                <h3 class="text-3xl font-bold">LKR <span id="balance">0.00</span></h3>
            </div>
        </div>

        <!-- Setup Section (shown initially) -->
        <div id="setupSection" class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-cog mr-2 text-orange-600"></i>Setup Distribution
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        <i class="fas fa-money-bill-wave mr-2 text-green-600"></i>Total Amount (LKR)
                    </label>
                    <input type="number" id="totalAmount" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none text-lg"
                        placeholder="Enter total amount (e.g., 100000)"
                        min="0"
                        step="0.01">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        <i class="fas fa-users mr-2 text-blue-600"></i>Number of Families
                    </label>
                    <input type="number" id="totalFamilies" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none text-lg"
                        placeholder="Enter number of families (e.g., 100)"
                        min="1"
                        step="1">
                </div>
            </div>

            <button id="setupBtn" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-lg transition duration-300 shadow-lg">
                <i class="fas fa-rocket mr-2"></i>Start Distribution
            </button>
        </div>

        <!-- Scanner Section (hidden initially) -->
        <div id="scannerSection" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-qrcode mr-2"></i>Scan Membership QR Code
                </h2>
                
                <div class="mb-4">
                    <button id="startScanBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-camera mr-2"></i>Start QR Code Scanner
                    </button>
                </div>

                <div id="reader" class="hidden mb-4"></div>

                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">Membership Number:</label>
                    <input type="text" id="membershipInput" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none text-lg"
                        placeholder="Scan QR code or enter manually">
                </div>

                <button id="manualSubmitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    <i class="fas fa-check mr-2"></i>Submit Distribution
                </button>
            </div>

            <!-- Export Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="exportBtn" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-file-excel mr-2"></i>Export to Excel
                    </button>
                    <button id="resetBtn" class="hidden flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-trash mr-2"></i>Reset All Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Records Table -->
        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-list mr-2"></i>Distribution Records (<span id="recordCount">0</span>)
            </h2>
            
            <!-- Desktop Table View -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-orange-600 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left rounded-tl-lg">#</th>
                            <th class="px-4 py-3 text-left">Membership No.</th>
                            <th class="px-4 py-3 text-left">Amount Given (LKR)</th>
                            <th class="px-4 py-3 text-left rounded-tr-lg">Time Distributed</th>
                        </tr>
                    </thead>
                    <tbody id="recordsTableDesktop" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                                <i class="fas fa-inbox text-4xl mb-2"></i>
                                <p>No records yet. Setup distribution to begin.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div id="recordsTableMobile" class="md:hidden space-y-3">
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-3"></i>
                    <p>No records yet. Setup distribution to begin.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let html5QrCode = null;
        let isScanning = false;
        let records = [];
        let config = null;

        // Navigate to home
        function goToHome() {
            Swal.fire({
                title: 'Go to Dashboard?',
                text: "You'll be redirected to the main dashboard",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#16a34a',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '<i class="fas fa-home mr-2"></i>Yes, go to Dashboard',
                cancelButtonText: 'Stay Here'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = 'index.html';
                }
            });
        }

        // Format currency
        function formatCurrency(amount) {
            return parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Format time
        function formatTime(date) {
            return new Date(date).toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // Load data from storage
        function loadData() {
            const savedRecords = JSON.parse(localStorage.getItem('cashRecords') || '[]');
            const savedConfig = JSON.parse(localStorage.getItem('cashConfig') || 'null');
            
            records = savedRecords;
            config = savedConfig;

            if (config) {
                document.getElementById('setupSection').classList.add('hidden');
                document.getElementById('scannerSection').classList.remove('hidden');
                updateFinancialDisplay();
            }

            updateTable();
            updateProgress();
        }

        // Save data to storage
        function saveData() {
            localStorage.setItem('cashRecords', JSON.stringify(records));
            localStorage.setItem('cashConfig', JSON.stringify(config));
        }

        // Update financial display
        function updateFinancialDisplay() {
            const totalAmount = config.totalAmount;
            const perFamilyAmount = config.perFamily;
            const distributed = records.length * perFamilyAmount;
            const balance = totalAmount - distributed;

            document.getElementById('totalBudget').textContent = formatCurrency(totalAmount);
            document.getElementById('perFamily').textContent = formatCurrency(perFamilyAmount);
            document.getElementById('balance').textContent = formatCurrency(balance);
            document.getElementById('totalFamiliesDisplay').textContent = config.totalFamilies;
        }

        // Update progress bar
        function updateProgress() {
            if (!config) return;

            const count = records.length;
            const total = config.totalFamilies;
            const percentage = Math.round((count / total) * 100);
            const remaining = total - count;

            document.getElementById('progressCount').textContent = count;
            document.getElementById('progressPercent').textContent = percentage;
            document.getElementById('progressBar').style.width = percentage + '%';
            
            if (percentage > 5) {
                document.getElementById('progressBarText').textContent = percentage + '%';
            } else {
                document.getElementById('progressBarText').textContent = '';
            }

            if (remaining > 0) {
                document.getElementById('remainingText').textContent = `${remaining} families remaining`;
            } else {
                document.getElementById('remainingText').innerHTML = '<i class="fas fa-check-circle mr-1 text-orange-600"></i>All families served!';
            }
        }

        // Update table display
        function updateTable() {
            const tbodyDesktop = document.getElementById('recordsTableDesktop');
            const mobileView = document.getElementById('recordsTableMobile');
            const countSpan = document.getElementById('recordCount');
            
            countSpan.textContent = records.length;

            if (records.length === 0) {
                tbodyDesktop.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>No records yet. ${config ? 'Start scanning to add distributions.' : 'Setup distribution to begin.'}</p>
                        </td>
                    </tr>
                `;
                
                mobileView.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>No records yet. ${config ? 'Start scanning to add distributions.' : 'Setup distribution to begin.'}</p>
                    </div>
                `;
                return;
            }

            // Desktop table view
            tbodyDesktop.innerHTML = records.map((record, index) => `
                <tr class="hover:bg-gray-50 transition duration-150">
                    <td class="px-4 py-3 font-semibold text-gray-700">${index + 1}</td>
                    <td class="px-4 py-3 font-mono text-blue-600">${record.membershipNo}</td>
                    <td class="px-4 py-3">
                        <span class="bg-green-100 text-green-800 px-3 py-2 rounded-full font-bold">
                            <i class="fas fa-money-bill mr-1"></i>LKR ${formatCurrency(record.amount)}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-gray-600">
                        <i class="fas fa-clock mr-1"></i>${formatTime(record.timestamp)}
                    </td>
                </tr>
            `).join('');

            // Mobile card view
            mobileView.innerHTML = records.map((record, index) => `
                <div class="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border-l-4 border-orange-500 shadow-sm">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="bg-orange-600 text-white text-xs font-bold px-2 py-1 rounded">
                                    #${index + 1}
                                </span>
                                <span class="text-xs text-gray-500">
                                    <i class="fas fa-clock mr-1"></i>${formatTime(record.timestamp)}
                                </span>
                            </div>
                            <div class="mb-2">
                                <p class="text-xs text-gray-600 mb-1">Membership Number</p>
                                <p class="font-mono text-lg font-bold text-blue-600">${record.membershipNo}</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between pt-2 border-t border-gray-200">
                        <span class="text-sm text-gray-600">Amount Given</span>
                        <span class="bg-green-500 text-white px-4 py-2 rounded-full font-bold text-lg">
                            <i class="fas fa-money-bill mr-1"></i>LKR ${formatCurrency(record.amount)}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Check if membership already received
        function checkDuplicate(membershipNo) {
            return records.find(r => r.membershipNo === membershipNo);
        }

        // Process distribution
        function processDistribution(membershipNo) {
            const duplicate = checkDuplicate(membershipNo);
            
            if (duplicate) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Already Distributed!',
                    html: `
                        <div class="text-left">
                            <p class="mb-2"><strong>Membership No:</strong> ${duplicate.membershipNo}</p>
                            <p class="mb-2"><strong>Amount Given:</strong> LKR ${formatCurrency(duplicate.amount)}</p>
                            <p class="mb-2"><strong>Time Distributed:</strong> ${formatTime(duplicate.timestamp)}</p>
                        </div>
                    `,
                    confirmButtonColor: '#dc2626',
                    confirmButtonText: 'OK'
                });
                return;
            }

            // Confirm distribution
            Swal.fire({
                title: 'Confirm Distribution',
                html: `
                    <div class="text-center">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded">
                            <p class="text-sm text-gray-600 mb-1">Membership Number</p>
                            <p class="text-xl font-mono font-bold text-blue-600">${membershipNo}</p>
                        </div>
                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                            <p class="text-sm text-gray-600 mb-1">Amount to Distribute</p>
                            <p class="text-2xl font-bold text-green-600">LKR ${formatCurrency(config.perFamily)}</p>
                        </div>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#f97316',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '<i class="fas fa-check mr-2"></i>Confirm Distribution',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    saveDistribution(membershipNo);
                }
            });
        }

        // Save distribution record
        function saveDistribution(membershipNo) {
            const record = {
                membershipNo,
                amount: config.perFamily,
                timestamp: new Date().toISOString()
            };

            records.unshift(record);
            saveData();
            updateTable();
            updateProgress();
            updateFinancialDisplay();

            Swal.fire({
                icon: 'success',
                title: 'Success!',
                html: `
                    <p class="mb-2">LKR ${formatCurrency(config.perFamily)} distributed successfully!</p>
                    <p class="text-sm text-gray-600">Remaining balance: LKR ${formatCurrency(config.totalAmount - (records.length * config.perFamily))}</p>
                `,
                timer: 2500,
                showConfirmButton: false
            });

            document.getElementById('membershipInput').value = '';
        }

        // Setup distribution
        document.getElementById('setupBtn').addEventListener('click', function() {
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            const totalFamilies = parseInt(document.getElementById('totalFamilies').value);

            if (!totalAmount || totalAmount <= 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Amount',
                    text: 'Please enter a valid total amount'
                });
                return;
            }

            if (!totalFamilies || totalFamilies <= 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Number',
                    text: 'Please enter a valid number of families'
                });
                return;
            }

            const perFamily = totalAmount / totalFamilies;

            config = {
                totalAmount,
                totalFamilies,
                perFamily
            };

            saveData();

            Swal.fire({
                icon: 'success',
                title: 'Distribution Setup Complete!',
                html: `
                    <div class="text-left">
                        <p class="mb-2"><strong>Total Amount:</strong> LKR ${formatCurrency(totalAmount)}</p>
                        <p class="mb-2"><strong>Total Families:</strong> ${totalFamilies}</p>
                        <p class="mb-2"><strong>Per Family:</strong> LKR ${formatCurrency(perFamily)}</p>
                    </div>
                `,
                confirmButtonColor: '#f97316',
                confirmButtonText: 'Start Distributing'
            }).then(() => {
                document.getElementById('setupSection').classList.add('hidden');
                document.getElementById('scannerSection').classList.remove('hidden');
                updateFinancialDisplay();
                updateProgress();
            });
        });

        // Start scanner
        document.getElementById('startScanBtn').addEventListener('click', function() {
            const readerDiv = document.getElementById('reader');
            
            if (isScanning) {
                html5QrCode.stop().then(() => {
                    readerDiv.classList.add('hidden');
                    isScanning = false;
                    this.innerHTML = '<i class="fas fa-camera mr-2"></i>Start QR Code Scanner';
                    this.classList.remove('bg-red-600', 'hover:bg-red-700');
                    this.classList.add('bg-orange-600', 'hover:bg-orange-700');
                });
                return;
            }

            readerDiv.classList.remove('hidden');
            
            html5QrCode = new Html5Qrcode("reader");
            
            html5QrCode.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    formatsToSupport: [0]
                },
                (decodedText) => {
                    document.getElementById('membershipInput').value = decodedText;
                    processDistribution(decodedText);
                    
                    html5QrCode.stop().then(() => {
                        readerDiv.classList.add('hidden');
                        isScanning = false;
                        document.getElementById('startScanBtn').innerHTML = '<i class="fas fa-camera mr-2"></i>Start QR Code Scanner';
                        document.getElementById('startScanBtn').classList.remove('bg-red-600', 'hover:bg-red-700');
                        document.getElementById('startScanBtn').classList.add('bg-orange-600', 'hover:bg-orange-700');
                    });
                }
            ).then(() => {
                isScanning = true;
                this.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Scanner';
                this.classList.remove('bg-orange-600', 'hover:bg-orange-700');
                this.classList.add('bg-red-600', 'hover:bg-red-700');
            }).catch(err => {
                Swal.fire({
                    icon: 'error',
                    title: 'Camera Error',
                    text: 'Unable to access camera. Please check permissions.'
                });
                readerDiv.classList.add('hidden');
            });
        });

        // Manual submit
        document.getElementById('manualSubmitBtn').addEventListener('click', function() {
            const membershipNo = document.getElementById('membershipInput').value.trim();
            
            if (!membershipNo) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please enter a membership number'
                });
                return;
            }

            processDistribution(membershipNo);
        });

        // Export to Excel
        document.getElementById('exportBtn').addEventListener('click', function() {
            if (records.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Data',
                    text: 'No records to export'
                });
                return;
            }

            const exportData = records.map((record, index) => ({
                '#': index + 1,
                'Membership Number': record.membershipNo,
                'Amount Given (LKR)': record.amount,
                'Time Distributed': formatTime(record.timestamp)
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Cash Distribution");

            const today = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `Cash_Distribution_${today}.xlsx`);

            Swal.fire({
                icon: 'success',
                title: 'Exported!',
                text: 'Data exported successfully',
                timer: 2000,
                showConfirmButton: false
            });

            document.getElementById('resetBtn').classList.remove('hidden');
        });

        // Reset data
        document.getElementById('resetBtn').addEventListener('click', function() {
            Swal.fire({
                title: 'Are you sure?',
                text: "This will delete all distribution records and configuration!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Yes, reset everything!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    records = [];
                    config = null;
                    saveData();
                    
                    document.getElementById('setupSection').classList.remove('hidden');
                    document.getElementById('scannerSection').classList.add('hidden');
                    document.getElementById('totalAmount').value = '';
                    document.getElementById('totalFamilies').value = '';
                    
                    updateTable();
                    updateProgress();
                    this.classList.add('hidden');
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Reset Complete',
                        text: 'All records and configuration have been cleared',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        });

        // Initialize
        loadData();
    </script>
</body>
</html>